<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script>
        window.addEventListener("message", sendCountRequest);

        var first = true;

        getSiteId();
        // Update count every 10 seconds
        setInterval(getSiteId, 10*1000);

        function getSiteId() {
            toParent({
                request: "getSiteId"
            });
        }

        function sendCountRequest(evt) {
            const site = evt.data.siteId;
            const endpoint = evt.data.ApiEndpoint;
            // Only increment counter first time
            const viewonly = first ? "" : "/view-only";
            first = false;
            fetch(endpoint + "site/" + site + viewonly)
                .then(response => response.json())
                .then(data => toParent(data));
        }

        function toParent(message) {
            window.parent.postMessage(message, "*");
        }
    </script>
</head>
<body>
    
</body>
</html>
